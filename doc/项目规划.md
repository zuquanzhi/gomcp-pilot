## gomcp-pilot 工程路线图

1. 概述
构建本地优先的 MCP 守护进程，解决客户端直连工具时的安全与可观测缺口。路线从“单通道验证”递进到“可审计的多进程编排”。

---
2. 阶段概览
- Sprint 1: PoC —— Go 与子进程 stdio 打通；验证阻塞/缓冲处理。
- Sprint 2: Gateway —— HTTP/SSE 到 JSON-RPC 桥接，支持 tools/list & tools/call。
- Sprint 3: Guard —— 拦截策略 + TUI 基础交互，支持手动放行/拒绝。
- Sprint 4: Orchestrator —— 配置驱动的多进程管理与路由，支持自动拉起/销毁。
- Sprint 5: Inspector —— SQLite 审计、TUI 历史视图、性能与稳定性加固。

---
3. 任务要点
- Sprint 1：封装进程启动/重启/退出；双向管道读写；最小 CLI。
- Sprint 2：SSE 推流与请求映射；鉴权 Token；基础日志。
- Sprint 3：策略引擎（Safe/Risky）；TUI 拦截界面；超时自动拒绝。
- Sprint 4：解析 config.yaml；多 upstream 并行；退出时清理子进程。
- Sprint 5：WAL 模式 SQLite；异步写入；历史查询与 UI 展示；跨平台兼容性检查。

---
4. 关键路径与风险
- Stdio 死锁/缓冲：必须有严格的读写协程与超时控制。
- TUI 与 HTTP 并发：共享状态需用消息驱动或锁保护，避免竞态。
- Windows 行为差异：MVP 先支持 Mac/Linux，Windows 延后验证。
- SQLite 写锁：开启 WAL + 单协程写入。

---
5. 验收标准
- config.yaml 即可启动；客户端可发现工具并调用成功。
- Risky 操作被拦截，可拒绝且客户端收到明确错误。
- 长时间运行无 goroutine 泄漏；退出时无残留子进程。
- 重启后审计可查历史记录。

---
6. 参考资源
- MCP Protocol Spec
- Bubbletea 示例
- Go Systems Programming（书）
